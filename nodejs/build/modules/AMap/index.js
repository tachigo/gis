'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _axios = _interopRequireDefault(require("axios"));

var _jsonfile = _interopRequireDefault(require("jsonfile"));

var _Utils = _interopRequireDefault(require("./../Utils"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const aMapKey = 'fc3a1a6cbfe82ef7055e5f8b26c04f60';

const http = _axios.default.create({
  baseURL: '',
  headers: {
    'User-Agent': 'Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; 360SE)'
  }
});

class AMap {
  static async getAMapDistrictInfo(keyword, filter) {
    const districts = [];
    const params = {
      keywords: keyword,
      extensions: 'all',
      // level: 'district',
      s: 'rsv3',
      output: 'json',
      key: aMapKey
    };

    if (filter) {
      params['filter'] = filter;
    }

    const data = await http.get('https://restapi.amap.com/v3/config/district', {
      params
    }).then(res => {
      return res.data['districts'];
    });

    for await (const item of data) {
      districts.push(item);
    }

    return districts;
  }

  static async polyLine2GeoJson(polyLine = '') {
    const geoJson = {
      type: 'MultiPolygon'
    };

    if (polyLine) {
      const lines = polyLine.split('|');
      const paths = [];
      lines.forEach(line => {
        const points = line.split(';');
        const path = [];
        points.forEach(point => {
          const pointArr = point.split(',');
          const lat = +pointArr[0];
          const lon = +pointArr[1];
          path.push([lat, lon]);
        });
        paths.push([path]);
      });
      geoJson.coordinates = paths;
    } else {
      geoJson.coordinates = [];
    }

    return geoJson;
  }

  static async getProvinces(filterFallback, fallback) {
    const list = await _jsonfile.default.readFileSync(`${__dirname}/provinces.json`);

    for await (const item of list) {
      const filter = await filterFallback(item);

      if (filter) {
        await _Utils.default.call(`获取 [${item.name}] 数据`, this.getProvince.bind(this), [item, fallback]);
      }
    }
  }

  static async getProvince(item, fallback) {
    await fallback(item);
  }

  static async loadProvinces(fallback) {
    const list = await _jsonfile.default.readFileSync(`${__dirname}/provinces.json`);

    for await (const item of list) {
      await _Utils.default.call(`加载 [${item.name}] 数据`, this.loadProvince.bind(this), [item, fallback]);
    }
  }

  static async loadProvince(item, fallback) {
    const data = await this.getAMapDistrictInfo(item['name']);
    const feature = data[0];
    let polyLine = '';

    if (feature && feature.polyline) {
      polyLine = feature.polyline;
    }

    const geoJson = await this.polyLine2GeoJson(polyLine); // index, zhName, level, parentIndex, iso, geoJson

    const params = [item.id, feature.name, 2, 1, '', geoJson];
    await fallback(...params);
  }

  static async loadChina(fallback) {
    const data = await this.getAMapDistrictInfo('中国');
    const feature = data[0];
    let polyLine = '';

    if (feature && feature.polyline) {
      polyLine = feature.polyline;
    }

    const geoJson = await this.polyLine2GeoJson(polyLine); // index, zhName, level, parentIndex, iso, geoJson

    const params = [1, feature.name, 1, 0, 'CHN', geoJson];
    await fallback(...params);
  }

}

var _default = AMap;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9tb2R1bGVzL0FNYXAvaW5kZXguanMiXSwibmFtZXMiOlsiYU1hcEtleSIsImh0dHAiLCJBeGlvcyIsImNyZWF0ZSIsImJhc2VVUkwiLCJoZWFkZXJzIiwiQU1hcCIsImdldEFNYXBEaXN0cmljdEluZm8iLCJrZXl3b3JkIiwiZmlsdGVyIiwiZGlzdHJpY3RzIiwicGFyYW1zIiwia2V5d29yZHMiLCJleHRlbnNpb25zIiwicyIsIm91dHB1dCIsImtleSIsImRhdGEiLCJnZXQiLCJ0aGVuIiwicmVzIiwiaXRlbSIsInB1c2giLCJwb2x5TGluZTJHZW9Kc29uIiwicG9seUxpbmUiLCJnZW9Kc29uIiwidHlwZSIsImxpbmVzIiwic3BsaXQiLCJwYXRocyIsImZvckVhY2giLCJsaW5lIiwicG9pbnRzIiwicGF0aCIsInBvaW50IiwicG9pbnRBcnIiLCJsYXQiLCJsb24iLCJjb29yZGluYXRlcyIsImdldFByb3ZpbmNlcyIsImZpbHRlckZhbGxiYWNrIiwiZmFsbGJhY2siLCJsaXN0IiwiSnNvbkZpbGUiLCJyZWFkRmlsZVN5bmMiLCJfX2Rpcm5hbWUiLCJVdGlscyIsImNhbGwiLCJuYW1lIiwiZ2V0UHJvdmluY2UiLCJiaW5kIiwibG9hZFByb3ZpbmNlcyIsImxvYWRQcm92aW5jZSIsImZlYXR1cmUiLCJwb2x5bGluZSIsImlkIiwibG9hZENoaW5hIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7OztBQUVBOztBQUNBOztBQUVBOzs7O0FBRUEsTUFBTUEsT0FBTyxHQUFHLGtDQUFoQjs7QUFHQSxNQUFNQyxJQUFJLEdBQUdDLGVBQU1DLE1BQU4sQ0FBYTtBQUN4QkMsRUFBQUEsT0FBTyxFQUFFLEVBRGU7QUFFeEJDLEVBQUFBLE9BQU8sRUFBRTtBQUNQLGtCQUFjO0FBRFA7QUFGZSxDQUFiLENBQWI7O0FBT0EsTUFBTUMsSUFBTixDQUFXO0FBRVQsZUFBYUMsbUJBQWIsQ0FBaUNDLE9BQWpDLEVBQTBDQyxNQUExQyxFQUFrRDtBQUNoRCxVQUFN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SUFBSSxHQUFHLE1BQU0sS0FBS1YsbUJBQUwsQ0FBeUIsSUFBekIsQ0FBbkI7QUFDQSxVQUFNOEMsT0FBTyxHQUFHcEMsSUFBSSxDQUFDLENBQUQsQ0FBcEI7QUFDQSxRQUFJTyxRQUFRLEdBQUcsRUFBZjs7QUFDQSxRQUFJNkIsT0FBTyxJQUFJQSxPQUFPLENBQUNDLFFBQXZCLEVBQWlDO0FBQy9COUIsTUFBQUEsUUFBUSxHQUFHNkIsT0FBTyxDQUFDQyxRQUFuQjtBQUNEOztBQUNELFVBQU03QixPQUFPLEdBQUcsTUFBTSxLQUFLRixnQkFBTCxDQUFzQkMsUUFBdEIsQ0FBdEIsQ0FQK0IsQ0FTL0I7O0FBQ0EsVUFBTWIsTUFBTSxHQUFHLENBQUMsQ0FBRCxFQUFJMEMsT0FBTyxDQUFDTCxJQUFaLEVBQWtCLENBQWxCLEVBQXFCLENBQXJCLEVBQXdCLEtBQXhCLEVBQStCdkIsT0FBL0IsQ0FBZjtBQUNBLFVBQU1nQixRQUFRLENBQUMsR0FBRzlCLE1BQUosQ0FBZDtBQUNEOztBQXZHUTs7ZUEyR0lMLEkiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbmltcG9ydCBBeGlvcyBmcm9tICdheGlvcyc7XG5pbXBvcnQgSnNvbkZpbGUgZnJvbSAnanNvbmZpbGUnO1xuXG5pbXBvcnQgVXRpbHMgZnJvbSAnLi8uLi9VdGlscyc7XG5cbmNvbnN0IGFNYXBLZXkgPSAnZmMzYTFhNmNiZmU4MmVmNzA1NWU1ZjhiMjZjMDRmNjAnO1xuXG5cbmNvbnN0IGh0dHAgPSBBeGlvcy5jcmVhdGUoe1xuICBiYXNlVVJMOiAnJyxcbiAgaGVhZGVyczoge1xuICAgICdVc2VyLUFnZW50JzogJ01vemlsbGEvNC4wIChjb21wYXRpYmxlOyBNU0lFIDcuMDsgV2luZG93cyBOVCA1LjE7IDM2MFNFKSdcbiAgfVxufSk7XG5cbmNsYXNzIEFNYXAge1xuXG4gIHN0YXRpYyBhc3luYyBnZXRBTWFwRGlzdHJpY3RJbmZvKGtleXdvcmQsIGZpbHRlcikge1xuICAgIGNvbnN0IGRpc3RyaWN0cyA9IFtdO1xuICAgIGNvbnN0IHBhcmFtcyA9IHtcbiAgICAgIGtleXdvcmRzOiBrZXl3b3JkLFxuICAgICAgZXh0ZW5zaW9uczogJ2FsbCcsXG4gICAgICAvLyBsZXZlbDogJ2Rpc3RyaWN0JyxcbiAgICAgIHM6ICdyc3YzJyxcbiAgICAgIG91dHB1dDogJ2pzb24nLFxuICAgICAga2V5OiBhTWFwS2V5XG4gICAgfTtcbiAgICBpZiAoZmlsdGVyKSB7XG4gICAgICBwYXJhbXNbJ2ZpbHRlciddID0gZmlsdGVyO1xuICAgIH1cbiAgICBjb25zdCBkYXRhID0gYXdhaXQgaHR0cFxuICAgICAgLmdldCgnaHR0cHM6Ly9yZXN0YXBpLmFtYXAuY29tL3YzL2NvbmZpZy9kaXN0cmljdCcsIHtcbiAgICAgICAgcGFyYW1zXG4gICAgICB9KVxuICAgICAgLnRoZW4ocmVzID0+IHtcbiAgICAgICAgcmV0dXJuIHJlcy5kYXRhWydkaXN0cmljdHMnXTtcbiAgICAgIH0pXG4gICAgO1xuICAgIGZvciBhd2FpdCAoY29uc3QgaXRlbSBvZiBkYXRhKSB7XG4gICAgICBkaXN0cmljdHMucHVzaChpdGVtKTtcbiAgICB9XG4gICAgcmV0dXJuIGRpc3RyaWN0cztcbiAgfVxuXG5cbiAgc3RhdGljIGFzeW5jIHBvbHlMaW5lMkdlb0pzb24ocG9seUxpbmUgPSAnJykge1xuICAgIGNvbnN0IGdlb0pzb24gPSB7XG4gICAgICB0eXBlOiAnTXVsdGlQb2x5Z29uJ1xuICAgIH07XG4gICAgaWYgKHBvbHlMaW5lKSB7XG4gICAgICBjb25zdCBsaW5lcyA9IHBvbHlMaW5lLnNwbGl0KCd8Jyk7XG4gICAgICBjb25zdCBwYXRocyA9IFtdO1xuICAgICAgbGluZXMuZm9yRWFjaChsaW5lID0+IHtcbiAgICAgICAgY29uc3QgcG9pbnRzID0gbGluZS5zcGxpdCgnOycpO1xuICAgICAgICBjb25zdCBwYXRoID0gW107XG4gICAgICAgIHBvaW50cy5mb3JFYWNoKHBvaW50ID0+IHtcbiAgICAgICAgICBjb25zdCBwb2ludEFyciA9IHBvaW50LnNwbGl0KCcsJyk7XG4gICAgICAgICAgY29uc3QgbGF0ID0gK3BvaW50QXJyWzBdO1xuICAgICAgICAgIGNvbnN0IGxvbiA9ICtwb2ludEFyclsxXTtcbiAgICAgICAgICBwYXRoLnB1c2goW2xhdCwgbG9uXSk7XG4gICAgICAgIH0pO1xuICAgICAgICBwYXRocy5wdXNoKFtwYXRoXSk7XG4gICAgICB9KTtcbiAgICAgIGdlb0pzb24uY29vcmRpbmF0ZXMgPSBwYXRocztcbiAgICB9IGVsc2Uge1xuICAgICAgZ2VvSnNvbi5jb29yZGluYXRlcyA9IFtdO1xuICAgIH1cbiAgICByZXR1cm4gZ2VvSnNvbjtcbiAgfVxuXG5cbiAgc3RhdGljIGFzeW5jIGdldFByb3ZpbmNlcyhmaWx0ZXJGYWxsYmFjaywgZmFsbGJhY2spIHtcbiAgICBjb25zdCBsaXN0ID0gYXdhaXQgSnNvbkZpbGUucmVhZEZpbGVTeW5jKGAke19fZGlybmFtZX0vcHJvdmluY2VzLmpzb25gKTtcbiAgICBmb3IgYXdhaXQgKGNvbnN0IGl0ZW0gb2YgbGlzdCkge1xuICAgICAgY29uc3QgZmlsdGVyID0gYXdhaXQgZmlsdGVyRmFsbGJhY2soaXRlbSk7XG4gICAgICBpZiAoZmlsdGVyKSB7XG4gICAgICAgIGF3YWl0IFV0aWxzLmNhbGwoYOiOt+WPliBbJHtpdGVtLm5hbWV9XSDmlbDmja5gLCB0aGlzLmdldFByb3ZpbmNlLmJpbmQodGhpcyksIFtpdGVtLCBmYWxsYmFja10pO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHN0YXRpYyBhc3luYyBnZXRQcm92aW5jZShpdGVtLCBmYWxsYmFjaykge1xuICAgIGF3YWl0IGZhbGxiYWNrKGl0ZW0pO1xuICB9XG5cbiAgc3RhdGljIGFzeW5jIGxvYWRQcm92aW5jZXMoZmFsbGJhY2spIHtcbiAgICBjb25zdCBsaXN0ID0gYXdhaXQgSnNvbkZpbGUucmVhZEZpbGVTeW5jKGAke19fZGlybmFtZX0vcHJvdmluY2VzLmpzb25gKTtcbiAgICBmb3IgYXdhaXQgKGNvbnN0IGl0ZW0gb2YgbGlzdCkge1xuICAgICAgYXdhaXQgVXRpbHMuY2FsbChg5Yqg6L29IFske2l0ZW0ubmFtZX1dIOaVsOaNrmAsIHRoaXMubG9hZFByb3ZpbmNlLmJpbmQodGhpcyksIFtpdGVtLCBmYWxsYmFja10pO1xuICAgIH1cbiAgfVxuXG4gIHN0YXRpYyBhc3luYyBsb2FkUHJvdmluY2UoaXRlbSwgZmFsbGJhY2spIHtcbiAgICBjb25zdCBkYXRhID0gYXdhaXQgdGhpcy5nZXRBTWFwRGlzdHJpY3RJbmZvKGl0ZW1bJ25hbWUnXSk7XG4gICAgY29uc3QgZmVhdHVyZSA9IGRhdGFbMF07XG4gICAgbGV0IHBvbHlMaW5lID0gJyc7XG4gICAgaWYgKGZlYXR1cmUgJiYgZmVhdHVyZS5wb2x5bGluZSkge1xuICAgICAgcG9seUxpbmUgPSBmZWF0dXJlLnBvbHlsaW5lO1xuICAgIH1cbiAgICBjb25zdCBnZW9Kc29uID0gYXdhaXQgdGhpcy5wb2x5TGluZTJHZW9Kc29uKHBvbHlMaW5lKTtcblxuICAgIC8vIGluZGV4LCB6aE5hbWUsIGxldmVsLCBwYXJlbnRJbmRleCwgaXNvLCBnZW9Kc29uXG4gICAgY29uc3QgcGFyYW1zID0gW2l0ZW0uaWQsIGZlYXR1cmUubmFtZSwgMiwgMSwgJycsIGdlb0pzb25dO1xuICAgIGF3YWl0IGZhbGxiYWNrKC4uLnBhcmFtcyk7XG4gIH1cblxuICBzdGF0aWMgYXN5bmMgbG9hZENoaW5hKGZhbGxiYWNrKSB7XG4gICAgY29uc3QgZGF0YSA9IGF3YWl0IHRoaXMuZ2V0QU1hcERpc3RyaWN0SW5mbygn5Lit5Zu9Jyk7XG4gICAgY29uc3QgZmVhdHVyZSA9IGRhdGFbMF07XG4gICAgbGV0IHBvbHlMaW5lID0gJyc7XG4gICAgaWYgKGZlYXR1cmUgJiYgZmVhdHVyZS5wb2x5bGluZSkge1xuICAgICAgcG9seUxpbmUgPSBmZWF0dXJlLnBvbHlsaW5lO1xuICAgIH1cbiAgICBjb25zdCBnZW9Kc29uID0gYXdhaXQgdGhpcy5wb2x5TGluZTJHZW9Kc29uKHBvbHlMaW5lKTtcblxuICAgIC8vIGluZGV4LCB6aE5hbWUsIGxldmVsLCBwYXJlbnRJbmRleCwgaXNvLCBnZW9Kc29uXG4gICAgY29uc3QgcGFyYW1zID0gWzEsIGZlYXR1cmUubmFtZSwgMSwgMCwgJ0NITicsIGdlb0pzb25dO1xuICAgIGF3YWl0IGZhbGxiYWNrKC4uLnBhcmFtcyk7XG4gIH1cbn1cblxuXG5leHBvcnQgZGVmYXVsdCBBTWFwOyJdfQ==